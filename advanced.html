<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç´«å¾®æ–—æ•°é«˜çº§åŠŸèƒ½</title>
    <style>
        body { 
            font-family: "Microsoft YaHei", Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: rgba(255, 255, 255, 0.95); 
            padding: 30px; 
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
        }
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5rem;
        }
        .section { 
            margin: 20px 0; 
            padding: 20px; 
            background: #f9f9f9; 
            border-radius: 8px; 
            border-left: 4px solid #667eea;
        }
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .result { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }
        .input-group input {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”® ç´«å¾®æ–—æ•°é«˜çº§åŠŸèƒ½æ¼”ç¤º</h1>
            <p>æ·±åº¦åˆ†æç´«å¾®æ–—æ•°æ˜Ÿç›˜çš„å„ç§åŠŸèƒ½</p>
        </div>
        
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div id="debugInfo" class="debug-info">
            <strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong><span id="debugText">æ­£åœ¨åŠ è½½...</span>
        </div>
        
        <div class="section">
            <h3>ğŸ“Š ç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜</h3>
            <p>é¦–å…ˆç”Ÿæˆä¸€ä¸ªæ˜Ÿç›˜ä½œä¸ºæ¼”ç¤ºåŸºç¡€</p>
            <button class="btn" onclick="generateSampleAstrolabe()">ç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ (2000-08-16 å¯…æ—¶ å¥³)</button>
            <div id="sampleResult"></div>
        </div>
        
        <div class="section">
            <h3>1. æ˜Ÿè€€æŸ¥è¯¢åŠŸèƒ½</h3>
            <p>æŸ¥æ‰¾ç‰¹å®šæ˜Ÿè€€çš„ä½ç½®å’Œç›¸å…³ä¿¡æ¯</p>
            <button class="btn" onclick="findStar()">æŸ¥æ‰¾ç´«å¾®æ˜Ÿä½ç½®</button>
            <button class="btn" onclick="findStarPalaces()">æŸ¥æ‰¾ç´«å¾®æ˜Ÿä¸‰æ–¹å››æ­£</button>
            <button class="btn" onclick="findAllMajorStars()">æŸ¥æ‰¾æ‰€æœ‰ä¸»æ˜Ÿä½ç½®</button>
            <div id="starResult"></div>
        </div>
        
        <div class="section">
            <h3>2. å››åŒ–æŸ¥è¯¢åŠŸèƒ½</h3>
            <p>åˆ†æå››åŒ–æ˜Ÿçš„ä½ç½®å’Œå½±å“</p>
            <button class="btn" onclick="findMutagen()">æŸ¥æ‰¾åŒ–å¿Œæ˜Ÿ</button>
            <button class="btn" onclick="findAllMutagens()">æŸ¥æ‰¾æ‰€æœ‰å››åŒ–</button>
            <button class="btn" onclick="checkMutagen()">æ£€æŸ¥ç´«å¾®æ˜Ÿæ˜¯å¦åŒ–å¿Œ</button>
            <div id="mutagenResult"></div>
        </div>
        
        <div class="section">
            <h3>3. è¿é™æŸ¥è¯¢åŠŸèƒ½</h3>
            <p>æŸ¥çœ‹ä¸åŒæ—¶é—´çš„è¿åŠ¿å˜åŒ–</p>
            <div class="input-group">
                <label>æŸ¥è¯¢æ—¥æœŸï¼š</label>
                <input type="date" id="horoscopeDate" value="2025-01-01">
                <button class="btn" onclick="getHoroscope()">æŸ¥çœ‹æµå¹´è¿åŠ¿</button>
            </div>
            <button class="btn" onclick="getCurrentHoroscope()">æŸ¥çœ‹å½“å‰è¿åŠ¿</button>
            <div id="horoscopeResult"></div>
        </div>
        
        <div class="section">
            <h3>4. é“¾å¼æŸ¥è¯¢æ¼”ç¤º</h3>
            <p>å±•ç¤ºiztroå¼ºå¤§çš„é“¾å¼æŸ¥è¯¢åŠŸèƒ½</p>
            <button class="btn" onclick="chainQuery1()">ç´«å¾®æ˜Ÿä¸‰æ–¹å››æ­£æ˜¯å¦æœ‰åŒ–å¿Œ</button>
            <button class="btn" onclick="chainQuery2()">å‘½å®«æ˜¯å¦æœ‰ä¸»æ˜Ÿ</button>
            <button class="btn" onclick="chainQuery3()">è´¢å¸›å®«ä¸‰æ–¹å››æ­£çš„æ˜Ÿè€€</button>
            <div id="chainResult"></div>
        </div>
        
        <div class="section">
            <h3>5. å®«ä½åˆ†æåŠŸèƒ½</h3>
            <p>åˆ†æç‰¹å®šå®«ä½çš„è¯¦ç»†ä¿¡æ¯</p>
            <button class="btn" onclick="analyzePalace('å‘½')">åˆ†æå‘½å®«</button>
            <button class="btn" onclick="analyzePalace('è´¢å¸›')">åˆ†æè´¢å¸›å®«</button>
            <button class="btn" onclick="analyzePalace('å¤«å¦»')">åˆ†æå¤«å¦»å®«</button>
            <button class="btn" onclick="findEmptyPalaces()">æŸ¥æ‰¾ç©ºå®«</button>
            <div id="palaceResult"></div>
        </div>
    </div>

    <!-- å¼•å…¥åº“æ–‡ä»¶ -->
    <script src="https://cdn.jsdelivr.net/npm/iztro@latest/dist/index.min.js"></script>
    <script>
        let astrolabe = null; // å…¨å±€æ˜Ÿç›˜å˜é‡
        
        // è°ƒè¯•å‡½æ•°
        function updateDebugInfo(message) {
            document.getElementById('debugText').textContent = message;
        }
        
        // æ£€æŸ¥åº“åŠ è½½çŠ¶æ€
        function checkLibraryStatus() {
            if (typeof iztro !== 'undefined') {
                updateDebugInfo('âœ… iztroåº“åŠ è½½æˆåŠŸï¼ç‰ˆæœ¬ï¼š' + (iztro.version || 'æœªçŸ¥'));
                return true;
            } else {
                updateDebugInfo('âŒ iztroåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                return false;
            }
        }
        
        // ç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜
        function generateSampleAstrolabe() {
            try {
                if (!checkLibraryStatus()) {
                    alert('åº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    return;
                }
                
                updateDebugInfo('æ­£åœ¨ç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜...');
                astrolabe = iztro.astro.bySolar('2000-8-16', 2, 'å¥³', true, 'zh-CN');
                
                document.getElementById('sampleResult').innerHTML = `
                    <div class="result">
                        <h4>âœ… ç¤ºä¾‹æ˜Ÿç›˜ç”ŸæˆæˆåŠŸï¼</h4>
                        <p><strong>åŸºæœ¬ä¿¡æ¯ï¼š</strong></p>
                        <p>æ€§åˆ«ï¼š${astrolabe.gender} | é˜³å†ï¼š${astrolabe.solarDate} | å†œå†ï¼š${astrolabe.lunarDate}</p>
                        <p>æ˜Ÿåº§ï¼š${astrolabe.sign} | ç”Ÿè‚–ï¼š${astrolabe.zodiac}</p>
                        <p>å‘½å®«ï¼š${astrolabe.soul} | èº«å®«ï¼š${astrolabe.body}</p>
                    </div>
                `;
                
                updateDebugInfo('âœ… ç¤ºä¾‹æ˜Ÿç›˜ç”ŸæˆæˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–åŠŸèƒ½äº†');
                console.log('ç¤ºä¾‹æ˜Ÿç›˜ï¼š', astrolabe);
            } catch (error) {
                updateDebugInfo('âŒ ç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜å¤±è´¥ï¼š' + error.message);
                console.error('ç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜å¤±è´¥ï¼š', error);
            }
        }
        
        // 1. æŸ¥æ‰¾æ˜Ÿè€€ä½ç½®
        function findStar() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const result = astrolabe.star('ç´«å¾®');
                document.getElementById('starResult').innerHTML = `
                    <div class="result">
                        <h4>ç´«å¾®æ˜Ÿä½ç½®æŸ¥è¯¢ç»“æœï¼š</h4>
                        <p>ç´«å¾®æ˜Ÿä½äºï¼š<strong>${result.palace().name}</strong></p>
                        <p>è¯¥å®«ä½å¤©å¹²åœ°æ”¯ï¼š<strong>${result.palace().heavenlyStem}${result.palace().earthlyBranch}</strong></p>
                        <p>ç´«å¾®æ˜Ÿäº®åº¦ï¼š<strong>${result.brightness()}</strong></p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('starResult').innerHTML = `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function findStarPalaces() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const result = astrolabe.star('ç´«å¾®').surroundedPalaces();
                let palaceNames = result.map(p => p.name).join('ã€');
                document.getElementById('starResult').innerHTML += `
                    <div class="result">
                        <h4>ç´«å¾®æ˜Ÿä¸‰æ–¹å››æ­£ï¼š</h4>
                        <p><strong>${palaceNames}</strong></p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('starResult').innerHTML += `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function findAllMajorStars() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const majorStarNames = ['ç´«å¾®', 'å¤©æœº', 'å¤ªé˜³', 'æ­¦æ›²', 'å¤©åŒ', 'å»‰è´', 'å¤©åºœ', 'å¤ªé˜´', 'è´ªç‹¼', 'å·¨é—¨', 'å¤©ç›¸', 'å¤©æ¢', 'ä¸ƒæ€', 'ç ´å†›'];
                let starPositions = [];
                
                majorStarNames.forEach(starName => {
                    try {
                        const star = astrolabe.star(starName);
                        if (star) {
                            starPositions.push(`${starName}ï¼š${star.palace().name}`);
                        }
                    } catch (e) {
                        // æŸäº›æ˜Ÿå¯èƒ½ä¸å­˜åœ¨ï¼Œå¿½ç•¥é”™è¯¯
                    }
                });
                
                document.getElementById('starResult').innerHTML += `
                    <div class="result">
                        <h4>æ‰€æœ‰ä¸»æ˜Ÿä½ç½®ï¼š</h4>
                        <p>${starPositions.join(' | ')}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('starResult').innerHTML += `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        // 2. å››åŒ–æŸ¥è¯¢
        function findMutagen() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const result = astrolabe.haveMutagen('å¿Œ');
                let palaceNames = result.map(p => p.name).join('ã€');
                document.getElementById('mutagenResult').innerHTML = `
                    <div class="result">
                        <h4>åŒ–å¿Œæ˜Ÿæ‰€åœ¨å®«ä½ï¼š</h4>
                        <p><strong>${palaceNames || 'æ— åŒ–å¿Œ'}</strong></p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('mutagenResult').innerHTML = `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function findAllMutagens() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const mutagens = ['ç¦„', 'æƒ', 'ç§‘', 'å¿Œ'];
                let mutagenResults = [];
                
                mutagens.forEach(mutagen => {
                    const result = astrolabe.haveMutagen(mutagen);
                    const palaces = result.map(p => p.name).join('ã€');
                    mutagenResults.push(`åŒ–${mutagen}ï¼š${palaces || 'æ— '}`);
                });
                
                document.getElementById('mutagenResult').innerHTML += `
                    <div class="result">
                        <h4>æ‰€æœ‰å››åŒ–åˆ†å¸ƒï¼š</h4>
                        <p>${mutagenResults.join('<br>')}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('mutagenResult').innerHTML += `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function checkMutagen() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const result = astrolabe.star('ç´«å¾®').mutagen();
                document.getElementById('mutagenResult').innerHTML += `
                    <div class="result">
                        <h4>ç´«å¾®æ˜Ÿå››åŒ–æƒ…å†µï¼š</h4>
                        <p><strong>${result || 'æ— å››åŒ–'}</strong></p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('mutagenResult').innerHTML += `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        // 3. è¿é™æŸ¥è¯¢
        function getHoroscope() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const date = document.getElementById('horoscopeDate').value;
                const horoscope = astrolabe.horoscope(date);
                
                document.getElementById('horoscopeResult').innerHTML = `
                    <div class="result">
                        <h4>${date} çš„è¿é™ä¿¡æ¯ï¼š</h4>
                        <p><strong>å¤§é™ï¼š</strong>${horoscope.decadal.range} (${horoscope.decadal.palaceName})</p>
                        <p><strong>æµå¹´ï¼š</strong>${horoscope.yearly.year} (${horoscope.yearly.palaceName})</p>
                        <p><strong>æµæœˆï¼š</strong>${horoscope.monthly.month} (${horoscope.monthly.palaceName})</p>
                        <p><strong>æµæ—¥ï¼š</strong>${horoscope.daily.date} (${horoscope.daily.palaceName})</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('horoscopeResult').innerHTML = `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function getCurrentHoroscope() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const horoscope = astrolabe.horoscope(today);
                
                document.getElementById('horoscopeResult').innerHTML += `
                    <div class="result">
                        <h4>å½“å‰è¿åŠ¿ (${today})ï¼š</h4>
                        <p><strong>å¤§é™ï¼š</strong>${horoscope.decadal.range} (${horoscope.decadal.palaceName})</p>
                        <p><strong>æµå¹´ï¼š</strong>${horoscope.yearly.year} (${horoscope.yearly.palaceName})</p>
                        <p><strong>æµæœˆï¼š</strong>${horoscope.monthly.month} (${horoscope.monthly.palaceName})</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('horoscopeResult').innerHTML += `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        // 4. é“¾å¼æŸ¥è¯¢
        function chainQuery1() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const result = astrolabe.star('ç´«å¾®').surroundedPalaces().haveMutagen('å¿Œ');
                document.getElementById('chainResult').innerHTML = `
                    <div class="result">
                        <h4>ç´«å¾®æ˜Ÿä¸‰æ–¹å››æ­£åŒ–å¿Œæƒ…å†µï¼š</h4>
                        <p><strong>${result.length > 0 ? `æœ‰åŒ–å¿Œï¼Œä½äºï¼š${result.map(p => p.name).join('ã€')}` : 'æ— åŒ–å¿Œ'}</strong></p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('chainResult').innerHTML = `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function chainQuery2() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const soulPalace = astrolabe.palace('å‘½');
                const hasMajorStars = soulPalace.majorStars.length > 0;
                
                document.getElementById('chainResult').innerHTML += `
                    <div class="result">
                        <h4>å‘½å®«ä¸»æ˜Ÿæƒ…å†µï¼š</h4>
                        <p><strong>${hasMajorStars ? `æœ‰ä¸»æ˜Ÿï¼š${soulPalace.majorStars.map(s => s.name).join('ã€')}` : 'å‘½å®«æ— ä¸»æ˜Ÿï¼ˆç©ºå®«ï¼‰'}</strong></p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('chainResult').innerHTML += `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function chainQuery3() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const result = astrolabe.palace('è´¢å¸›').surroundedPalaces();
                const allStars = [];
                
                result.forEach(palace => {
                    palace.majorStars.forEach(star => allStars.push(star.name));
                });
                
                document.getElementById('chainResult').innerHTML += `
                    <div class="result">
                        <h4>è´¢å¸›å®«ä¸‰æ–¹å››æ­£çš„ä¸»æ˜Ÿï¼š</h4>
                        <p><strong>${allStars.length > 0 ? allStars.join('ã€') : 'æ— ä¸»æ˜Ÿ'}</strong></p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('chainResult').innerHTML += `<div class="result">æŸ¥è¯¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        // 5. å®«ä½åˆ†æ
        function analyzePalace(palaceName) {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const palace = astrolabe.palace(palaceName);
                const majorStars = palace.majorStars.map(s => s.name).join('ã€') || 'æ— ';
                const minorStars = palace.minorStars.map(s => s.name).join('ã€') || 'æ— ';
                
                document.getElementById('palaceResult').innerHTML = `
                    <div class="result">
                        <h4>${palaceName}å®«è¯¦ç»†åˆ†æï¼š</h4>
                        <p><strong>å¤©å¹²åœ°æ”¯ï¼š</strong>${palace.heavenlyStem}${palace.earthlyBranch}</p>
                        <p><strong>ä¸»æ˜Ÿï¼š</strong>${majorStars}</p>
                        <p><strong>è¾…æ˜Ÿï¼š</strong>${minorStars}</p>
                        <p><strong>æ˜¯å¦ç©ºå®«ï¼š</strong>${palace.majorStars.length === 0 ? 'æ˜¯' : 'å¦'}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('palaceResult').innerHTML = `<div class="result">åˆ†æå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function findEmptyPalaces() {
            if (!astrolabe) {
                alert('è¯·å…ˆç”Ÿæˆç¤ºä¾‹æ˜Ÿç›˜ï¼');
                return;
            }
            
            try {
                const emptyPalaces = astrolabe.palaces.filter(palace => palace.majorStars.length === 0);
                const emptyNames = emptyPalaces.map(p => p.name).join('ã€');
                
                document.getElementById('palaceResult').innerHTML += `
                    <div class="result">
                        <h4>ç©ºå®«åˆ†æï¼š</h4>
                        <p><strong>ç©ºå®«ï¼š</strong>${emptyNames || 'æ— ç©ºå®«'}</p>
                        <p><strong>ç©ºå®«æ•°é‡ï¼š</strong>${emptyPalaces.length}/12</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('palaceResult').innerHTML += `<div class="result">åˆ†æå¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥åº“çŠ¶æ€
        window.onload = function() {
            setTimeout(() => {
                checkLibraryStatus();
            }, 1000);
        };
    </script>
</body>
</html>