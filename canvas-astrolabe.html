<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Canvasæ˜Ÿç›˜ç»˜åˆ¶</title>
    <style>
        body { font-family: "Microsoft YaHei", Arial, sans-serif; margin: 0; padding: 20px; background: #f0f0f0; }
        .container { max-width: 1000px; margin: 0 auto; text-align: center; }
        #astrolabeCanvas { border: 2px solid #333; background: white; border-radius: 10px; }
        .controls { margin: 20px 0; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Canvasæ˜Ÿç›˜ç»˜åˆ¶</h1>
        <div class="controls">
            <input type="date" id="birthDate" value="2000-08-16">
            <select id="birthHour">
                <option value="0">å­æ—¶</option>
                <option value="1">ä¸‘æ—¶</option>
                <option value="2" selected>å¯…æ—¶</option>
                <option value="3">å¯æ—¶</option>
                <option value="4">è¾°æ—¶</option>
                <option value="5">å·³æ—¶</option>
                <option value="6">åˆæ—¶</option>
                <option value="7">æœªæ—¶</option>
                <option value="8">ç”³æ—¶</option>
                <option value="9">é…‰æ—¶</option>
                <option value="10">æˆŒæ—¶</option>
                <option value="11">äº¥æ—¶</option>
            </select>
            <select id="gender">
                <option value="å¥³">å¥³</option>
                <option value="ç”·">ç”·</option>
            </select>
            <button class="btn" onclick="drawAstrolabe()">ç»˜åˆ¶æ˜Ÿç›˜</button>
        </div>
        <canvas id="astrolabeCanvas" width="800" height="800"></canvas>
    </div>

    <script src="node_modules/iztro/dist/index.min.js"></script>
    <script>
        function drawAstrolabe() {
            const canvas = document.getElementById('astrolabeCanvas');
            const ctx = canvas.getContext('2d');
            
            // è·å–ç”¨æˆ·è¾“å…¥
            const birthDate = document.getElementById('birthDate').value;
            const birthHour = parseInt(document.getElementById('birthHour').value);
            const gender = document.getElementById('gender').value;
            
            // ç”Ÿæˆæ˜Ÿç›˜æ•°æ®
            const astrolabe = iztro.astro.bySolar(birthDate, birthHour, gender, true, 'zh-CN');
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶12å®«æ ¼
            drawPalaceGrid(ctx, astrolabe.palaces);
            
            // ç»˜åˆ¶ä¸­å¤®ä¿¡æ¯
            drawCenterInfo(ctx, astrolabe);
        }
        
        function drawPalaceGrid(ctx, palaces) {
            const canvasWidth = 800;
            const canvasHeight = 800;
            const cellWidth = canvasWidth / 4;
            const cellHeight = canvasHeight / 4;
            
            // 12å®«ä½ç½®æ˜ å°„ï¼ˆæŒ‰ä¼ ç»Ÿå¸ƒå±€ï¼‰
            const positions = [
                {x: 3, y: 3}, // å‘½å®«
                {x: 3, y: 2}, {x: 3, y: 1}, {x: 3, y: 0}, // çˆ¶æ¯ã€ç¦å¾·ã€ç”°å®…
                {x: 2, y: 0}, // å®˜ç¦„
                {x: 1, y: 0}, // äº¤å‹
                {x: 0, y: 0}, {x: 0, y: 1}, {x: 0, y: 2}, {x: 0, y: 3}, // è¿ç§»ã€ç–¾å„ã€è´¢å¸›ã€å­å¥³
                {x: 1, y: 3}, // å¤«å¦»
                {x: 2, y: 3}  // å…„å¼Ÿ
            ];
            
            palaces.forEach((palace, index) => {
                if (positions[index]) {
                    const pos = positions[index];
                    const x = pos.x * cellWidth;
                    const y = pos.y * cellHeight;
                    
                    // ç»˜åˆ¶å®«ä½è¾¹æ¡†
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, cellWidth, cellHeight);
                    
                    // ç»˜åˆ¶å®«ä½åç§°
                    ctx.fillStyle = '#000';
                    ctx.font = 'bold 16px Microsoft YaHei';
                    ctx.textAlign = 'center';
                    ctx.fillText(palace.name, x + cellWidth/2, y + 25);
                    
                    // ç»˜åˆ¶å¤©å¹²åœ°æ”¯
                    ctx.font = '14px Microsoft YaHei';
                    ctx.fillText(palace.heavenlyStem + palace.earthlyBranch, x + cellWidth/2, y + 45);
                    
                    // ç»˜åˆ¶æ˜Ÿè€€
                    drawStars(ctx, x, y, cellWidth, cellHeight, palace);
                }
            });
        }
        
        function drawStars(ctx, x, y, width, height, palace) {
            let yOffset = 65;
            
            // ç»˜åˆ¶ä¸»æ˜Ÿ
            if (palace.majorStars && palace.majorStars.length > 0) {
                palace.majorStars.forEach(star => {
                    ctx.fillStyle = '#ff0000';
                    ctx.font = 'bold 12px Microsoft YaHei';
                    ctx.fillText(star.name, x + width/2, y + yOffset);
                    yOffset += 18;
                });
            }
            
            // ç»˜åˆ¶è¾…æ˜Ÿ
            if (palace.minorStars && palace.minorStars.length > 0) {
                palace.minorStars.forEach(star => {
                    ctx.fillStyle = '#ff8800';
                    ctx.font = '11px Microsoft YaHei';
                    ctx.fillText(star.name, x + width/2, y + yOffset);
                    yOffset += 16;
                });
            }
            
            // ç»˜åˆ¶æ‚è€€ï¼ˆåªæ˜¾ç¤ºå‰å‡ ä¸ªï¼Œé¿å…è¿‡äºæ‹¥æŒ¤ï¼‰
            if (palace.miscStars && palace.miscStars.length > 0) {
                palace.miscStars.slice(0, 3).forEach(star => {
                    ctx.fillStyle = '#008800';
                    ctx.font = '10px Microsoft YaHei';
                    ctx.fillText(star.name, x + width/2, y + yOffset);
                    yOffset += 14;
                });
            }
        }
        
        function drawCenterInfo(ctx, astrolabe) {
            const centerX = 400;
            const centerY = 400;
            
            // ç»˜åˆ¶ä¸­å¤®èƒŒæ™¯
            ctx.fillStyle = 'rgba(0, 123, 255, 0.1)';
            ctx.fillRect(200, 200, 400, 400);
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#007bff';
            ctx.font = 'bold 24px Microsoft YaHei';
            ctx.textAlign = 'center';
            ctx.fillText('ç´«å¾®æ–—æ•°', centerX, centerY - 80);
            
            // ç»˜åˆ¶åŸºç¡€ä¿¡æ¯
            ctx.fillStyle = '#333';
            ctx.font = '16px Microsoft YaHei';
            ctx.fillText(`æ€§åˆ«ï¼š${astrolabe.gender}`, centerX, centerY - 40);
            ctx.fillText(`ç”Ÿæ—¥ï¼š${astrolabe.solarDate}`, centerX, centerY - 20);
            ctx.fillText(`æ˜Ÿåº§ï¼š${astrolabe.sign}`, centerX, centerY);
            ctx.fillText(`ç”Ÿè‚–ï¼š${astrolabe.zodiac}`, centerX, centerY + 20);
            ctx.fillText(`å‘½å®«ï¼š${astrolabe.soul}`, centerX, centerY + 40);
            ctx.fillText(`èº«å®«ï¼š${astrolabe.body}`, centerX, centerY + 60);
        }
        
        // é¡µé¢åŠ è½½æ—¶ç»˜åˆ¶é»˜è®¤æ˜Ÿç›˜
        window.onload = function() {
            drawAstrolabe();
        };
    </script>
</body>
</html>